!function(e,o){o.fSquare={clientId:"GQVM3TG2JHRG53PTWCZSCQDKUKQJH34I1BUOJOLLHOSBL1Q0",clientSecret:"M41YZKEES3UIG4QYWVMQ0HQIMUPD0G1YD5ZSQTYUPJLVG4DD",popularPlacesByCity:function(e,o){return"https://api.foursquare.com/v2/venues/explore?client_id="+this.clientId+"&client_secret="+this.clientSecret+"&near="+o+"&section="+e+"&limit=20&day=any&time=any&radius=1500&v=20140806&m=foursquare"},popularPlacesByLocation:function(e,o,t){return"https://api.foursquare.com/v2/venues/explore?client_id="+this.clientId+"&client_secret="+this.clientSecret+"&ll="+o+","+t+"&section="+e+"&limit=20&day=any&time=any&radius=1500&v=20140806&m=foursquare"},topPicksPlacesByLocation:function(e){return"https://api.foursquare.com/v2/venues/explore?client_id="+this.clientId+"&client_secret="+this.clientSecret+"&ll="+e.lat+","+e.lng+"&section=topPicks&limit=20&day=any&time=any&radius=1500&v=20140806&m=foursquare"},getEvents:function(){return"https://api.foursquare.com/v2/events/categories?client_id="+this.clientId+"&client_secret="+this.clientSecret+"&v=20140806&m=foursquare"},getPlaces:function(e,o){return"https://api.foursquare.com/v2/venues/search?client_id="+this.clientId+"&client_secret="+this.clientSecret+"&ll="+o.lat+","+o.lng+"&query="+e+"&limit=30&day=any&time=any&radius=1500&v=20140806&m=foursquare"},getPlacePhotos:function(e){return"https://api.foursquare.com/v2/venues/"+e.id+"/photos?client_id="+this.clientId+"&client_secret="+this.clientSecret+"&v=20140806&m=foursquare"},getPlaceHours:function(e){return"https://api.foursquare.com/v2/venues/"+e.id+"/hours?client_id="+this.clientId+"&client_secret="+this.clientSecret+"&v=20140806&m=foursquare"}}}(window,window.APIs||(window.APIs={})),function(e,o,t){t.MAP_OPTIONS={center:{lat:33.7833019,lng:-84.3828403},mapTypeId:o.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,scrollwheel:!1,panControl:!1,draggable:!0,panControlOptions:{position:o.maps.ControlPosition.TOP_RIGHT},zoom:14,zoomControl:!0,zoomControlOptions:{style:o.maps.ZoomControlStyle.SMALL,position:o.maps.ControlPosition.TOP_LEFT},mapTypeControl:!1,mapTypeControlOptions:{style:o.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:o.maps.ControlPosition.TOP_CENTER}}}(window,google,window.mapLib||(window.mapLib={})),function(e){"use strict";function o(){function o(){var e,e=mapLib.MAP_OPTIONS;c=new google.maps.Map(document.getElementById("map"),e),u=new google.maps.InfoWindow}function t(){for(var e in h.localityMarkers())h.localityMarkers()[e].setMap(null),h.localityMarkers()[e]=null;for(;h.localityMarkers().length>0;)h.localityMarkers().pop()}function r(){for(var e in h.venueMarkers())h.venueMarkers()[e].marker.setMap(null),h.venueMarkers()[e].marker=null;for(;h.venueMarkers().length>0;)h.venueMarkers().pop()}function s(e){for(var o in h.venueMarkers())null===h.venueMarkers()[o].marker.map&&h.venueMarkers()[o].marker.setMap(c),-1===h.venueMarkers()[o].name.indexOf(e)&&-1===h.venueMarkers()[o].category.indexOf(e)&&h.venueMarkers()[o].marker.setMap(null)}function a(e){d=new google.maps.Geocoder,d.geocode({address:e},function(e,o){o==google.maps.GeocoderStatus.OK?h.findFourSquerelocalityPlaces(c,"topPicks",e[0]):(h.errorMessage("There was a problem requestiong the location: "+o),h.errorClass("alert alert-danger"))})}function n(e){if(e)switch(e.code){case e.PERMISSION_DENIED:h.errorMessage("The Geolocation service failed: User denied the request for Geolocation."),h.errorClass("error-message");break;case e.POSITION_UNAVAILABLE:h.errorMessage("The Geolocation service failed: Location information is unavailable."),h.errorClass("error-message");break;case e.TIMEOUT:h.errorMessage("The Geolocation service failed: The request to get user location timed out."),h.errorClass("error-message");break;case e.UNKNOWN_ERROR:h.errorMessage("The Geolocation service failed: An unknown error occurred."),h.errorClass("error-message")}else h.errorMessage("Error: Your browser doesn't support geolocation."),h.errorClass("error-message")}function i(e){var o,t=e.location.lat,r=e.location.lng,s=e.name.toLowerCase(),a=new google.maps.LatLng(t,r),n=e.categories[0].name.toLowerCase(),i=e.location.address,l=e.location.formattedAddress[1],d=e.location.country,u="https://foursquare.com/v/"+e.id,m=e.rating,v=m/2;o=v>=4.9?"images/star-5.0.png":4.9>v&&v>=4.25?"images/star-4.5.png":4.25>v&&v>=3.75?"images/star-4.0.png":3.75>v&&v>=3.25?"images/star-3.5.png":3.25>v&&v>=2.75?"images/star-3.0.png":"images/star-2.5.png";var f,w='<div class="container infowindow"><p><a href="'+u+'" target="_blank"><span class="v-name">'+s+'</span></a></p><p class="v-category"><span>'+n+'</span></p><p class="v-address"><span>'+i+", "+l+", "+d+".<span></p>";f=void 0!=m?'<div  class="v-rating-cont"><p><a href="'+u+'" target="_blank"><img class="fs-icon" src="images/foursquare-icon-25x25.png"></a><span class="v-rating">'+m.toFixed(1)+'</span><img src="'+o+'" class="rating-stars"></p></div></div>':'<p class="v-rating-cont"><a href="'+u+'" target="_blank"><img class="fs-icon" src="images/images/foursquare-icon-25x25.png"></a><span class="v-rating"><em>no rating available</em></span></p></div></div>';var k=new google.maps.Marker({map:c,position:a,name:s,title:s,animation:google.maps.Animation.DROP});h.venueMarkers().push(new g(k,s,n,a));var y={position:a,map:c,content:w+f,ShadowStyle:2,Padding:5,borderRadius:10,borderWidth:2,borderColor:"#40B3DF",backgroundColor:"#fff",minWidth:230,maxWidth:400,minHeight:300,maxHeight:180,arrowSize:15,arrowPosition:50,backgroundClassName:"noscrollbar",arrowStyle:0};p=new InfoBubble,google.maps.event.addListener(k,"click",function(){p.setOptions(y),p.open(c,this),c.panTo(a)})}function l(o,t){var r=document.getElementsByClassName("holder")[0],s=document.getElementsByClassName("slider")[0],a=document.getElementsByClassName("slide"),n=window.innerWidth-10,i=o.length,l=new Event("click");if(r.style.width=100*i+"%",s.style.width=n+"px",e(".slide").width(n),navigator.msMaxTouchPoints)s.classList.add("ms-touch");else{var c={el:{slider:s,holder:r},slideWidth:n,touchstartx:void 0,touchmovex:void 0,movex:void 0,index:0,init:function(){this.bindUIEvents()},reset:function(){this.el.holder.style.transform="translate3d(-"+this.index*this.slideWidth+"px,0,0)",this.movex=0,this.index=0,i>0&&a[0].dispatchEvent(l)},bindUIEvents:function(){this.el.holder.addEventListener("touchstart",function(e){c.start(e)}),this.el.holder.addEventListener("touchmove",function(e){c.move(e)}),this.el.holder.addEventListener("touchend",function(e){c.end(e)})},start:function(o){this.touchstartx=o.touches[0].pageX,e(".animate").removeClass("animate")},move:function(e){this.touchmovex=e.touches[0].pageX,this.movex=this.index*this.slideWidth+(this.touchstartx-this.touchmovex),this.movex<this.slideWidth*(i-1)&&(this.el.holder.style.transform="translate3d(-"+this.movex+"px,0,0)")},end:function(){var e=Math.abs(this.index*this.slideWidth-this.movex);e>this.slideWidth/2&&(this.movex>this.index*this.slideWidth&&this.index<i-1?this.index++:this.movex<this.index*this.slideWidth&&this.index>0&&this.index--),a[this.index].dispatchEvent(l),h.leftArrowTouch(0===this.index||0===i?!1:!0),h.rightArrowTouch(this.index===i-1||2>i?!1:!0),this.el.holder.classList.add("animate"),this.el.holder.style.transform="translate3d(-"+this.index*this.slideWidth+"px,0,0)"}};c.init(),(""!=t||a.length>0)&&(c.reset(),h.leftArrowTouch(!1)),h.rightArrowTouch(2>i?!1:!0)}}var c,d,u,p,g=function(e,o,t,r){this.marker=e,this.name=o,this.category=t,this.position=r},h=this;h.localityMarkers=ko.observableArray([]),h.venueMarkers=ko.observableArray([]),h.neighborhood=ko.observable("Midtown, Atlanta"),h.popularPlacesList=ko.observableArray([]),h.filteredPlacesList=ko.observableArray(h.popularPlacesList()),h.keywordToSearch=ko.observable(""),h.showList=ko.observable(!0),h.showLocationSearch=ko.observable(!0),h.errorMessage=ko.observable(""),h.errorClass=ko.observable(""),h.leftArrowTouch=ko.observable(!1),h.rightArrowTouch=ko.observable(!0),"object"==typeof google&&"object"==typeof google.maps&&"object"==typeof google.maps.event&&"object"==typeof google.maps.places?(e("#spinner").hide(),google.maps.event.addDomListener(window,"load",o())):(e("#spinner").show(),h.errorMessage("The map could not be loaded. Please reload the page."),h.errorClass("error-message")),h.updateMarkers=ko.computed(function(){""!=h.neighborhood()&&(h.venueMarkers().length>0&&r(),t(),a(h.neighborhood()),h.keywordToSearch(""))},{pure:!0}),h.clickMarker=function(e){var o=e.venue.name.toLowerCase();for(var t in h.venueMarkers())h.venueMarkers()[t].name===o&&(google.maps.event.trigger(h.venueMarkers()[t].marker,"click"),c.panTo(h.venueMarkers()[t].position))},h.findFourSquerelocalityPlaces=function(o,t,r){var s,a=r.geometry.location.lat(),n=r.geometry.location.lng(),l=new google.maps.LatLng(a,n),c=r.formatted_address;h.createLocalityMarker(o,c,l,"images/location.png");var d=APIs.fSquare.popularPlacesByLocation(t,a,n);e("#spinner").show(),e.getJSON(d).done(function(o){e("#spinner").hide(),h.popularPlacesList(o.response.groups[0].items),h.items=ko.utils.arrayForEach(h.popularPlacesList(),function(e){s=e.venue,i(s)}),h.adjustMapBounds()}).fail(function(e){"timeout"===e.status?(h.errorMessage("Something is wrong with the connection. Please, try again."),h.errorClass("error-message")):"error"===e.statusText?(h.errorMessage("Foursquare servers are experiencing problems. Please, try again later."),h.errorClass("error-message")):"object"==typeof e.responseJSON&&(h.errorMessage("Data request failed. Please, reload the page or try again later. "),h.errorClass("error-message"))})},h.getUserGeolocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var o=e.coords.latitude,s=e.coords.longitude,a=new google.maps.LatLng(o,s);d=new google.maps.Geocoder,d.geocode({latLng:a},function(e,o){o==google.maps.GeocoderStatus.OK?(h.venueMarkers().length>0&&r(),t(),h.findFourSquerelocalityPlaces(c,"topPicks",e[0])):(h.errorMessage("There was a problem requestiong the location: "+o),h.errorClass("alert alert-danger"))})},function(){n(!0)}):(h.errorMessage("Geolocation is not supported by this browser."),h.errorClass("error-message"))},h.createLocalityMarker=function(e,o,t,r){var s=new google.maps.Marker({map:e,title:o,position:t,icon:r,animation:google.maps.Animation.BOUNCE});h.localityMarkers().push(s),google.maps.event.addListener(s,"click",function(){"undefined"!=typeof u&&u.close(),u=new google.maps.InfoWindow,u.setContent(o),u.open(e,s)})},h.displayFilteredList=ko.computed(function(){for(var e,o,t=[],r=h.keywordToSearch().toLowerCase(),s=h.popularPlacesList().length-1;s>=0;s--)e=h.popularPlacesList()[s].venue.name,o=h.popularPlacesList()[s].venue.categories[0].name,(-1!=e.toLowerCase().indexOf(r)||-1!=o.toLowerCase().indexOf(r))&&t.push(h.popularPlacesList()[s]);h.filteredPlacesList(t)},{pure:!0}),h.displayMarkers=ko.computed(function(){s(h.keywordToSearch().toLowerCase())},{pure:!0}),h.togglePlacesList=function(){var o=e(".list-container"),t=e("#collapse-btn");o.slideToggle("slow"),t.hasClass("glyphicon-chevron-up")?(t.removeClass("glyphicon-chevron-up"),t.addClass("glyphicon-chevron-down")):(t.removeClass("glyphicon-chevron-down"),t.addClass("glyphicon-chevron-up"))},h.toggleLocationSearch=function(){var o=e(".locationBar"),t=e(".toggle-setting").text(),r=e(".toggle-setting");o.slideToggle("slow"),r.html("Hide Search Bar"===t?"Show Search Bar":"Hide Search Bar")},h.setMapSize=ko.computed(function(){e("#map").height(e(window).height())}),google.maps.event.addDomListener(window,"resize",function(){var e=c.getCenter();c.setCenter(e),h.adjustMapBounds()}),h.adjustMapBounds=function(){var o=new google.maps.LatLngBounds,t=h.venueMarkers().length;if(t>=2){for(var r=0;t>r;r++)o.extend(h.venueMarkers()[r].marker.position);e("#map").height(e(window).height()),c.fitBounds(o)}},h.mobileList=ko.computed(function(){window.innerWidth<900&&l(h.filteredPlacesList(),h.keywordToSearch())},{pure:!0})}ko.applyBindings(new o)}(jQuery);